# n8n Workflow Contracts

This directory contains workflow design specifications and generated JSON exports for all n8n workflows in the Email Classification MVP.

## Implementation Strategy

**PRIMARY**: Workflows are created **programmatically using n8n MCP (Model Context Protocol) tools**
**FALLBACK**: Manual UI creation (for environments without MCP access)

## Design Documents

1. **workflow-structure.md** - Complete node flow designs for all 5 workflows
2. **README.md** - This file (usage and import guide)

## Generated Workflow Files (Created During Implementation)

These JSON files will be generated by `/speckit.implement` using n8n MCP tools:

1. **email-processing-main.json** - Main orchestration workflow with Gmail trigger
2. **classification-workflow.json** - AI-powered email classification
3. **organization-workflow.json** - Gmail label and archive operations
4. **notification-workflow.json** - Telegram notifications with quiet hours
5. **send-queued-notifications.json** - Scheduled workflow for quiet hours

## MCP-Based Workflow Creation

Workflows are created using n8n MCP tools available in this environment:

```javascript
// Example: Create workflow programmatically
mcp__n8n-mcp__n8n_create_workflow({
  name: "Classification-Workflow",
  nodes: [...],  // Node definitions from workflow-structure.md
  connections: {...},  // Connection mappings
  settings: {
    executionOrder: "v1",
    saveExecutionProgress: true
  }
})

// Validate before deployment
mcp__n8n-mcp__validate_workflow({ id: "workflow-id" })

// Export for version control
// Workflow JSON automatically saved to contracts/ directory
```

**Benefits**:
- ✅ Automated workflow generation from specifications
- ✅ Version-controlled workflow definitions
- ✅ Automatic validation before deployment
- ✅ Reproducible across environments
- ✅ CI/CD pipeline integration ready

## Usage

These specifications serve as:
- **Architecture documentation**: Design specifications for all workflows
- **Implementation guides**: Node types, connections, and configuration patterns
- **Version control**: Track workflow changes alongside code
- **MCP inputs**: Source material for programmatic workflow generation

## Importing into n8n

1. Open n8n instance
2. Navigate to Workflows
3. Click "Import from File"
4. Select JSON file
5. Configure credentials (Gmail, OpenAI, Supabase, Telegram)
6. Activate workflow

## Template Structure

Each JSON file follows n8n's workflow export format:
```json
{
  "name": "Workflow Name",
  "nodes": [...],  // Array of node configurations
  "connections": {...},  // Node connection mappings
  "settings": {...},  // Workflow-level settings
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-11-15T00:00:00.000Z",
  "versionId": "uuid"
}
```

## Node Type Reference

All nodes use n8n native nodes per constitution:
- **Trigger**: `n8n-nodes-base.gmailTrigger`
- **Gmail**: `n8n-nodes-base.gmail`
- **AI Agent**: `@n8n/n8n-nodes-langchain.agent`
- **OpenAI Chat Model**: `@n8n/n8n-nodes-langchain.lmChatOpenAi`
- **Embeddings OpenAI**: `@n8n/n8n-nodes-langchain.embeddingsOpenAi`
- **Supabase Vector Store**: `@n8n/n8n-nodes-langchain.vectorStoreSupabase`
- **Default Data Loader**: `@n8n/n8n-nodes-langchain.documentDefaultDataLoader`
- **Structured Output Parser**: `@n8n/n8n-nodes-langchain.outputParserStructured`
- **Telegram**: `n8n-nodes-base.telegram`
- **Supabase**: `n8n-nodes-base.supabase`
- **Code**: `n8n-nodes-base.code`
- **Execute Workflow**: `n8n-nodes-base.executeWorkflow`

## Credential Requirements

Configure these credentials in n8n before activating workflows:
- **Gmail OAuth2**: For email access
- **OpenAI API**: For GPT-4 and embeddings
- **Supabase**: Service key for database access
- **Telegram Bot**: Bot token from BotFather

## Notes

- Templates contain placeholder values (e.g., `YOUR_OPENAI_API_KEY`)
- Actual credentials configured via n8n credential vault
- Node positions are approximate for visual clarity
- Production workflows may have additional error handling nodes
